<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Lexichord.Modules.RAG.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Lexichord.Modules.RAG.Views.KnowledgeHubView"
             x:DataType="vm:KnowledgeHubViewModel">

    <!-- =============================================================================
    File: KnowledgeHubView.axaml
    Project: Lexichord.Modules.RAG
    Description: Knowledge Hub unified dashboard view for RAG functionality.
    Version: v0.6.4a
    ============================================================================= -->
    <!-- LOGIC: Two-column layout with stats panel and embedded search.
         - Column 0: Statistics and quick actions sidebar
         - Column 1: Main search interface (embedded ReferenceView)
    -->

    <UserControl.Styles>
        <!-- Statistics Card Style -->
        <Style Selector="Border.stat-card">
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltHighBrush}" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>

        <!-- Stat Value Style -->
        <Style Selector="TextBlock.stat-value">
            <Setter Property="FontSize" Value="28" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Foreground" Value="{DynamicResource AccentPrimaryBrush}" />
        </Style>

        <!-- Stat Label Style -->
        <Style Selector="TextBlock.stat-label">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
            <Setter Property="Margin" Value="0,4,0,0" />
        </Style>

        <!-- Section Header Style -->
        <Style Selector="TextBlock.section-header">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}" />
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>

        <!-- Recent Search Item Style -->
        <Style Selector="Border.recent-search-item">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Padding" Value="8,6" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <Style Selector="Border.recent-search-item:pointerover">
            <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListLowBrush}" />
        </Style>

        <!-- License Warning Style -->
        <Style Selector="Border.license-warning">
            <Setter Property="Background" Value="#FFF4E4" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="20" />
        </Style>
    </UserControl.Styles>

    <Grid>
        <!-- License Warning (shown when not licensed) -->
        <Border Classes="license-warning"
                IsVisible="{Binding !IsLicensed}"
                VerticalAlignment="Center"
                HorizontalAlignment="Center"
                MaxWidth="400">
            <StackPanel Spacing="16" HorizontalAlignment="Center">
                <PathIcon Data="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"
                         Width="48" Height="48" Foreground="#B25000"
                         HorizontalAlignment="Center" />
                <TextBlock Text="Knowledge Hub requires WriterPro"
                           FontSize="18"
                           FontWeight="SemiBold"
                           Foreground="#B25000"
                           HorizontalAlignment="Center" />
                <TextBlock Text="Upgrade to WriterPro to access the Knowledge Hub, including semantic search, document indexing, and intelligent context retrieval."
                           TextWrapping="Wrap"
                           TextAlignment="Center"
                           Foreground="#B25000"
                           FontSize="13" />
                <Button Content="Upgrade to WriterPro"
                        HorizontalAlignment="Center"
                        Classes="accent" />
            </StackPanel>
        </Border>

        <!-- Main Content (shown when licensed) -->
        <Grid ColumnDefinitions="280,*"
              IsVisible="{Binding IsLicensed}">

            <!-- ===================================================================
            Column 0: Statistics Sidebar
            =================================================================== -->
            <Border Grid.Column="0"
                    Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                    Padding="16">
                <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                              VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="8">

                        <!-- Header -->
                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,16">
                            <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                                     Width="24" Height="24"
                                     Foreground="{DynamicResource AccentPrimaryBrush}" />
                            <TextBlock Text="Knowledge Hub"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center" />
                        </StackPanel>

                        <!-- Index Statistics Section -->
                        <TextBlock Text="INDEX STATISTICS" Classes="section-header" />

                        <!-- Documents Card -->
                        <Border Classes="stat-card">
                            <Grid ColumnDefinitions="*,Auto">
                                <StackPanel>
                                    <TextBlock Text="{Binding Statistics.IndexedDocuments}"
                                               Classes="stat-value" />
                                    <TextBlock Text="Indexed Documents" Classes="stat-label" />
                                </StackPanel>
                                <PathIcon Grid.Column="1"
                                         Data="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"
                                         Width="32" Height="32"
                                         Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                         VerticalAlignment="Center" />
                            </Grid>
                        </Border>

                        <!-- Chunks Card -->
                        <Border Classes="stat-card">
                            <Grid ColumnDefinitions="*,Auto">
                                <StackPanel>
                                    <TextBlock Text="{Binding Statistics.TotalChunks}"
                                               Classes="stat-value" />
                                    <TextBlock Text="Total Chunks" Classes="stat-label" />
                                </StackPanel>
                                <PathIcon Grid.Column="1"
                                         Data="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"
                                         Width="32" Height="32"
                                         Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                         VerticalAlignment="Center" />
                            </Grid>
                        </Border>

                        <!-- Storage Card -->
                        <Border Classes="stat-card">
                            <Grid ColumnDefinitions="*,Auto">
                                <StackPanel>
                                    <TextBlock Text="{Binding Statistics.FormattedStorageSize}"
                                               Classes="stat-value" />
                                    <TextBlock Text="Storage Used" Classes="stat-label" />
                                </StackPanel>
                                <PathIcon Grid.Column="1"
                                         Data="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"
                                         Width="32" Height="32"
                                         Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                         VerticalAlignment="Center" />
                            </Grid>
                        </Border>

                        <!-- Pending Documents -->
                        <Border Classes="stat-card"
                                IsVisible="{Binding Statistics.PendingDocuments, Converter={x:Static BoolConverters.IsNotNull}}">
                            <StackPanel>
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Statistics.PendingDocuments}"
                                                   Classes="stat-value" />
                                        <TextBlock Text="Pending Indexing" Classes="stat-label" />
                                    </StackPanel>
                                    <PathIcon Grid.Column="1"
                                             Data="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"
                                             Width="32" Height="32"
                                             Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                             VerticalAlignment="Center" />
                                </Grid>
                                <!-- Progress bar for indexing -->
                                <ProgressBar Minimum="0" Maximum="100"
                                             Value="{Binding IndexingProgress}"
                                             Margin="0,8,0,0"
                                             IsVisible="{Binding IsIndexing}" />
                            </StackPanel>
                        </Border>

                        <!-- Quick Actions Section -->
                        <TextBlock Text="QUICK ACTIONS" Classes="section-header" Margin="0,16,0,0" />

                        <Button Command="{Binding ReindexAllCommand}"
                                IsEnabled="{Binding !IsIndexing}"
                                HorizontalAlignment="Stretch">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <PathIcon Data="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"
                                         Width="16" Height="16" />
                                <TextBlock Text="Re-index All Documents" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <!-- Recent Searches Section -->
                        <TextBlock Text="RECENT SEARCHES" Classes="section-header" Margin="0,24,0,0" />

                        <!-- Empty State -->
                        <TextBlock Text="No recent searches"
                                   FontSize="12"
                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                                   IsVisible="{Binding RecentSearches.Count, Converter={x:Static ObjectConverters.IsNull}}" />

                        <!-- Recent Searches List -->
                        <ItemsControl ItemsSource="{Binding RecentSearches}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Classes="recent-search-item">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <StackPanel>
                                                <TextBlock Text="{Binding Query}"
                                                           TextTrimming="CharacterEllipsis"
                                                           FontSize="13" />
                                                <TextBlock FontSize="11"
                                                           Foreground="{DynamicResource SystemControlForegroundBaseMediumLowBrush}">
                                                    <TextBlock.Text>
                                                        <MultiBinding StringFormat="{}{0} results · {1}">
                                                            <Binding Path="ResultCount" />
                                                            <Binding Path="RelativeTime" />
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                            </StackPanel>
                                            <PathIcon Grid.Column="1"
                                                     Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                                                     Width="14" Height="14"
                                                     Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                                     VerticalAlignment="Center" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Last Indexed Time -->
                        <StackPanel Margin="0,24,0,0"
                                    IsVisible="{Binding Statistics.LastIndexedAt, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <TextBlock Text="Last indexed:"
                                       FontSize="11"
                                       Foreground="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" />
                            <TextBlock Text="{Binding Statistics.LastIndexedAt, StringFormat='{}{0:g}'}"
                                       FontSize="11"
                                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- ===================================================================
            Column 1: Search Interface (Placeholder for embedded ReferenceView)
            =================================================================== -->
            <Grid Grid.Column="1">
                <!-- Loading Overlay -->
                <Border IsVisible="{Binding IsLoading}"
                        Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                        ZIndex="100">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16">
                        <Border Width="48" Height="48"
                                CornerRadius="24"
                                Background="{DynamicResource AccentPrimaryBrush}"
                                Opacity="0.6">
                            <TextBlock Text="●"
                                       FontSize="32"
                                       Foreground="White"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center" />
                        </Border>
                        <TextBlock Text="Loading Knowledge Hub..."
                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                    </StackPanel>
                </Border>

                <!-- Error Message -->
                <Border IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                        Background="#FDECEA"
                        Padding="16"
                        CornerRadius="8"
                        Margin="16"
                        VerticalAlignment="Top">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"
                                 Width="20" Height="20" Foreground="#C42B1C" />
                        <TextBlock Text="{Binding ErrorMessage}"
                                   Foreground="#C42B1C"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </Border>

                <!-- Main Search Content Area -->
                <!-- Note: In production, this would contain the embedded ReferenceView -->
                <Border Padding="16"
                        IsVisible="{Binding !IsLoading}">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16">
                        <PathIcon Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                                 Width="64" Height="64"
                                 Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                        <TextBlock Text="Search Your Knowledge Base"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center" />
                        <TextBlock Text="Use the search panel to find relevant content across your indexed documents."
                                   TextWrapping="Wrap"
                                   TextAlignment="Center"
                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                   MaxWidth="400" />
                    </StackPanel>
                </Border>
            </Grid>

        </Grid>
    </Grid>
</UserControl>
